IF schema_id('ShoppingCart') IS NULL
    EXECUTE('CREATE SCHEMA [ShoppingCart]')
CREATE TABLE [ShoppingCart].[CartItems] (
    [CartItemId] [int] NOT NULL IDENTITY,
    [CartCookie] [nvarchar](max),
    [CartId] [int] NOT NULL,
    [ProductId] [int] NOT NULL,
    [SelectedDateTime] [datetime] NOT NULL,
    [CurrentPrice] [decimal](18, 2) NOT NULL,
    [Quantity] [int] NOT NULL,
    CONSTRAINT [PK_ShoppingCart.CartItems] PRIMARY KEY ([CartItemId])
)
CREATE INDEX [IX_CartId] ON [ShoppingCart].[CartItems]([CartId])
CREATE TABLE [ShoppingCart].[NewCarts] (
    [CartId] [int] NOT NULL IDENTITY,
    [CartCookie] [nvarchar](max),
    [Initialized] [datetime] NOT NULL,
    [Expires] [datetime] NOT NULL,
    [SourceUrl] [nvarchar](max),
    [CustomerId] [int] NOT NULL,
    [CustomerCookie] [nvarchar](max),
    CONSTRAINT [PK_ShoppingCart.NewCarts] PRIMARY KEY ([CartId])
)
ALTER TABLE [ShoppingCart].[CartItems] ADD CONSTRAINT [FK_ShoppingCart.CartItems_ShoppingCart.NewCarts_CartId] FOREIGN KEY ([CartId]) REFERENCES [ShoppingCart].[NewCarts] ([CartId]) ON DELETE CASCADE
CREATE TABLE [ShoppingCart].[__MigrationHistory] (
    [MigrationId] [nvarchar](150) NOT NULL,
    [ContextKey] [nvarchar](300) NOT NULL,
    [Model] [varbinary](max) NOT NULL,
    [ProductVersion] [nvarchar](32) NOT NULL,
    CONSTRAINT [PK_ShoppingCart.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
)
INSERT [ShoppingCart].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
VALUES (N'201606070040232_sc_init', N'ShoppingCart.Data.Migrations.Configuration',  0x1F8B0800000000000400DD5ADB6EE336107D2FD07F10F4D416D928C9BE6C037B17A9931446379746C9A26F0B461A3BC452A44A52A9DDA25FD6877E527FA143DD25CAB614E7D6222F112F8733C3B9704EF2CF5F7F8F3E2C22E6DC835454F0B1BBBFBBE73AC00311523E1FBB899EBD79E77E78FFF557A393305A389F8A756FCD3ADCC9D5D8BDD33A3EF43C15DC4144D46E4403299498E9DD40441E098577B0B7F7BDB7BFEF0142B888E538A3AB846B1A41FA819F13C103887542D8990881A97C1C67FC14D5392711A898043076FD3B11C728DD8448BD7B4C34719D2346090AE2039BB90EE15C68A251CCC31B05BE9682CFFD180708BB5EC680EB668429C8C53FAC96F7D564EFC068E2551B0BA820515A440301F7DFE6A6F1DADB1F6460B7341D1AEF048DAC9746EBD48063D7D86CAA21729DF661871326CDC2B67D710DE5BBC5BE1DA76376A7740BF41EF3B3E34C12A61309630E899684ED3897C92DA3C14FB0BC165F808F79C2585D529415E71A03387429450C522FAF60D6927F1ABA8ED7DCEFB501CAED1D7B334DA75CBF3D709D731486DC32281DA366155F0B093F020749348497446B9078AFD31052D35A52749C3911E20B85E24CF447B49EEB9C91C547E0737D3776F157D739A50B088B915C8E1B4E311071939609F4396AB36AEB31F0334C82AD61300E2140736170C235467981567D0F049C2452A2C12F250D2A3008684498EB5C4AFC2DCF5EEF5CC70F88C11D2EF5CF09C9EFB4BFEE23AF0AB1B581770EBF990B1A1A77F9B65711760F0DB9FF67B84D39351585FE0EE1D6EE7DB288A904B5358E2F1219C08D644F9F6C522F06B96DA628709EEAD2CEC93D9DA7AEB5A218A0D1AF80A52BD41D8DB3374411769F6BAB4EA588AE04AB42B99AFC9CD91DA517AB565C133907DD2F771C2925029A8AD44C1E35719A5A9EF0D0D9285B66D99A76685F4C1734C604815260F274DB89E0821F6326D7E01C05D9736642544042DBCCA849D85FA4C2183591AA774953A6EFACA3302981A905187BF8685498E628D77606A33CA031619BCCD2DA3820F919ADCB63DA33C7100337396B930DB63BBF3CA6751B9B6C34F26A3E66972DDCA37107C822ADD46A8F998345571DC3B7765ECA541E8C6D8F30D83E683B02AB38B0DCC1DB0CD20550BA786B7F4DEF0AA423DA6BEB56A684F675F489C252FE5274EB56FB444E0B2617BA1D944D653B324F79D155BBE565FD56D197792B1AB3D119495DA2D6A8E5238E9F75699337FEF0FE25CA30BC4075B431A5B4E549F858207368CDE2D128E929954A9BE6F096982A3109236B59975BAFF0B6E2C4B6E7DA7757F861B1C3FC6E4751DAB6565E6E67817CFB29EA17993492BE8B3A6EDDDE9AB6CC8411B9A6FB990896447C5347B509ADA8D96DB4627C185AA75C8364AA352F75A0DA707F2CBB83A943DAB303746DB4320D8D1B33FD11ABBEA58E568DDA4823AFE55F5665B11CD9AAF7CDC8E81D37DBC64C91D88787CCCA9D4FEB958F1B298DAEA30ED798E88F57761E75AC727040BC549D472350AAE1211152F516CDF8A8C687A375DE416BEE9923C52AC3ED25E5E965396E95DD515E023793A6564DCC9618F644DCD330AD874B8575200B33FF57366114F5AD169C114E67A074C624B8077BFB072DE2F5F590A09E5221EBC984BE380B498D9537121F431B6B8B09E1F7440677447E1391C5B775BCE1E4622AB1D5004CB115598CDD3FD22D87CEF497ECE11AEE381712FDE7D0D973FEDC9E914CCF7E243E32C46FFD587C64F8D47CE466CD07B3912F4605FE177CBE83E17BB0C3B418BE07E3580CDF76516DB1780F89AE6E0E6F80604F4884BD20EF557118CFCE733D17ADB5A6817D8534964D0BF423A8D6F253D933AAD9A9E08D67AEBE9A9B699F55BAE66A266BED49F92AFBA06725BC1AC4D40A0A6E458C74711B4F4268D92F6674B4DA3F23A0932B3AAF20CCBF2670081A2E56AE99F299283CBD2551B1A4952CCF4013CCFEE4486A3A23013E2144004AA57FEEF84458626A45740BE1945F243A4E34AA0CD12D6BB4F12662D69D9FB2764D99471771FA278EC75001C5A4A6805DF01F12CAC252EED38E07C90A08138A79E13777A9CD0360BE2C91CE05EF09949BAFCC20D710C50CC1D405F7C93D3C44B61B051F614E8265D1F8AC06D97C114DB38F8E29994B12A91CA3DA8F9FE8C361B478FF2F9C9C28D293230000 , N'6.1.3-40302')

IF OBJECT_ID(N'Maintenance.Products', N'U') IS NOT NULL
          BEGIN
           EXEC sp_execute 'CREATE VIEW ShoppingCart.ProductListing
           AS
           SELECT ProductId, Description, P.Name, P.CategoryID,
                   C.Name as Category, MaxQuantity, CurrentPrice
           FROM Maintenance.Products P
           LEFT Join Maintenance.Categories C
           ON P.CategoryId = C.CategoryId
           WHERE p.IsAvailable = 1'
         END
INSERT [ShoppingCart].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
VALUES (N'201606081329207_AddProductListingView', N'ShoppingCart.Data.Migrations.Configuration',  0x1F8B0800000000000400DD5ADB6EE336107D2FD07F10F4D416D928C9BE6C037B17A9931446379746C9A26F0B461A3BC452A44A52A9DDA25FD6877E527FA143DD25CAB614E7D6222F112F8733C3B9704EF2CF5F7F8F3E2C22E6DC835454F0B1BBBFBBE73AC00311523E1FBB899EBD79E77E78FFF557A393305A389F8A756FCD3ADCC9D5D8BDD33A3EF43C15DC4144D46E4403299498E9DD40441E098577B0B7F7BDB7BFEF0142B888E538A3AB846B1A41FA819F13C103887542D8990881A97C1C67FC14D5392711A898043076FD3B11C728DD8448BD7B4C34719D2346090AE2039BB90EE15C68A251CCC31B05BE9682CFFD180708BB5EC680EB668429C8C53FAC96F7D564EFC068E2551B0BA820515A440301F7DFE6A6F1DADB1F6460B7341D1AEF048DAC9746EBD48063D7D86CAA21729DF661871326CDC2B67D710DE5BBC5BE1DA76376A7740BF41EF3B3E34C12A61309630E899684ED3897C92DA3C14FB0BC165F808F79C2585D529415E71A03387429450C522FAF60D6927F1ABA8ED7DCEFB501CAED1D7B334DA75CBF3D709D731486DC32281DA366155F0B093F020749348497446B9078AFD31052D35A52749C3911E20B85E24CF447B49EEB9C91C547E0737D3776F157D739A50B088B915C8E1B4E311071939609F4396AB36AEB31F0334C82AD61300E2140736170C235467981567D0F049C2452A2C12F250D2A3008684498EB5C4AFC2DCF5EEF5CC70F88C11D2EF5CF09C9EFB4BFEE23AF0AB1B581770EBF990B1A1A77F9B65711760F0DB9FF67B84D39351585FE0EE1D6EE7DB288A904B5358E2F1219C08D644F9F6C522F06B96DA628709EEAD2CEC93D9DA7AEB5A218A0D1AF80A52BD41D8DB3374411769F6BAB4EA588AE04AB42B99AFC9CD91DA517AB565C133907DD2F771C2925029A8AD44C1E35719A5A9EF0D0D9285B66D99A76685F4C1734C604815260F274DB89E0821F6326D7E01C05D9736642544042DBCCA849D85FA4C2183591AA774953A6EFACA3302981A905187BF8685498E628D77606A33CA031619BCCD2DA3820F919ADCB63DA33C7100337396B930DB63BBF3CA6751B9B6C34F26A3E66972DDCA37107C822ADD46A8F998345571DC3B7765ECA541E8C6D8F30D83E683B02AB38B0DCC1DB0CD20550BA786B7F4DEF0AA423DA6BEB56A684F675F489C252FE5274EB56FB444E0B2617BA1D944D653B324F79D155BBE565FD56D197792B1AB3D119495DA2D6A8E5238E9F75699337FEF0FE25CA30BC4075B431A5B4E549F858207368CDE2D128E929954A9BE6F096982A3109236B59975BAFF0B6E2C4B6E7DA7757F861B1C3FC6E4751DAB6565E6E67817CFB29EA17993492BE8B3A6EDDDE9AB6CC8411B9A6FB990896447C5347B509ADA8D96DB4627C185AA75C8364AA352F75A0DA707F2CBB83A943DAB303746DB4320D8D1B33FD11ABBEA58E568DDA4823AFE55F5665B11CD9AAF7CDC8E81D37DBC64C91D88787CCCA9D4FEB958F1B298DAEA30ED798E88F57761E75AC727040BC549D472350AAE1211152F516CDF8A8C687A375DE416BEE9923C52AC3ED25E5E965396E95DD515E023793A6564DCC9618F644DCD330AD874B8575200B33FF57366114F5AD169C114E67A074C624B8077BFB072DE2F5F590A09E5221EBC984BE380B498D9537121F431B6B8B09E1F7440677447E1391C5B775BCE1E4622AB1D5004CB115598CDD3FD22D87CEF497ECE11AEE381712FDE7D0D973FEDC9E914CCF7E243E32C46FFD587C64F8D47CE466CD07B3912F4605FE177CBE83E17BB0C3B418BE07E3580CDF76516DB1780F89AE6E0E6F80604F4884BD20EF557118CFCE733D17ADB5A6817D8534964D0BF423A8D6F253D933AAD9A9E08D67AEBE9A9B699F55BAE66A266BED49F92AFBA06725BC1AC4D40A0A6E458C74711B4F4268D92F6674B4DA3F23A0932B3AAF20CCBF2670081A2E56AE99F299283CBD2551B1A4952CCF4013CCFEE4486A3A23013E2144004AA57FEEF84458626A45740BE1945F243A4E34AA0CD12D6BB4F12662D69D9FB2764D99471771FA278EC75001C5A4A6805DF01F12CAC252EED38E07C90A08138A79E13777A9CD0360BE2C91CE05EF09949BAFCC20D710C50CC1D405F7C93D3C44B61B051F614E8265D1F8AC06D97C114DB38F8E29994B12A91CA3DA8F9FE8C361B478FF2F9C9C28D293230000 , N'6.1.3-40302')

